= Niu Yunpeng - Project Portfolio
ifdef::env-github,env-browser[:outfilesuffix: .adoc]
:imagesDir: ../images
:stylesDir: ../stylesheets

== Purpose

This project portfolio documents the work I have done as a developer of the *BoNUS* development team. It describes the
features that I have added and purposed. Some sections from https://cs2103aug2017-t09-b3.github.io/main/UserGuide.html[User Guide]
and https://cs2103aug2017-t09-b3.github.io/main/DeveloperGuide.html[Developer Guide] are extracted out to help with the
explanation.

== Project: BoNUS

**BoNUS** is a desktop personal organizer application dedicated to NUS students to carry out various tasks such as storing
contacts, scheduling for upcoming events, timetable planning as well as a calendar to better organise their campus life.

This project is the result of a semester-long software engineering https://nus-cs2103.github.io/website/[module] at
http://www.nus.edu.sg/[NUS]. It is built by my teammates and me, as listed https://cs2103aug2017-t09-b3.github.io/main/AboutUs.html[here].
Most of the backend codes are written in Java, while https://docs.oracle.com/javase/8/javafx/get-started-tutorial/jfx-overview.htm#JFXST784[JavaFX]
is adapted as the frontend framework.

See our https://cs2103aug2017-t09-b3.github.io/[project website] or https://github.com/CS2103AUG2017-T09-B3/main[GitHub repository]
for more information.

*Code contributed*:

* https://github.com/CS2103AUG2017-T09-B3/main/blob/master/collated/main/yunpengn.md[Functional code]
* https://github.com/CS2103AUG2017-T09-B3/main/blob/master/collated/test/yunpengn.md[Test code]

=== Enhancement Added: Generic Property

==== Justification

All similar https://nus-cs2103.github.io/website/admin/projectList.html[products] have provided a few fields for users to
store their contacts' information. Our application *BoNUS* should provide something unique to stand out of them.

What if we provide the flexibility to allow users to define customize properties on their own? Different users certainly
have different requirements and thus would like to store different information about their contacts. The fields pre-defined
by the software may not suit their needs. Therefore, it is necessary to provide the `config --add-property` command to
allow users define as many customize properties as they want.

==== External behavior

Do you feel that the pre-defined properties in *BoNUS* does not suit your needs or you need more properties? No worry! You
can use `config -add-property` command to add a new customize property field.

Format: +
`config --add-property s/SHORT_NAME f/FULL_NAME [m/MESSAGE r/REGULAR_EXPRESSION]` +
or +
`cfg --add-property s/SHORT_NAME f/FULL_NAME [m/MESSAGE r/REGULAR_EXPRESSION]`

****
. You need to think of a short name for this new property (corresponding to `s/SHORT_NAME`).
. You should make sure this short name is unique, meaning that there is no existing property with the same short name.
. You need to define a full name for this new property (corresponding to `f/FULL_NAME`).
. You should choose an identifiable value for this full name because it will be displayed when you view the details of contacts.
. You can optionally write a constraint message for this new property (corresponding to `m/MESSAGE`).
. You can optionally write a regular expression to restrict the accepted value for this new property to be in certain
format (corresponding to `m/MESSAGE`).
****

Example:

* `config --add-property s/ag f/age`
* `config --add-property s/b f/birthday m/Birthday should be in the format of DD/MM/YYYY r/[^\s].*` +
After adding a new property _birthday_, you can use it when adding a new contact. +
`add n/Linda p/85438796 e/linda@example.com a/5 Marina Bay Road b/Jan 29, 1987 t/friends` +
Now, Linda's birthday is stored as Jan 29th, 1987.

[NOTE]
====
* You need to use the short name as the prefix in `add`/`addE` and `edit`/`editE` commands.
* Full name is used to display the name of each property on the right panel (to show details of the selected person, use `select` command).
* Constraint message is the string that will be shown in result display box when the input value for this property is invalid.
* Regular expression is used to check whether the input value for this property is valid.
====

==== Implementation

---

=== Generic property

We are using a generic `Property` class to support **arbitrary field** feature.

==== Inspiration

Users should not be limited to the provided four fields, i.e. `Name`, `Email`, `Phone`, `Address` (we are talking about
the contact component here, of course one more `DateTime` for event component). They should have the freedom to enter all
kinds of information about their contacts apart from the pre-defined ones.

Through a brief product survey on other existing similar software in the market, we found that they usually ask users to
type all other information in the _so-called_ `Description` or `Details` field. This is not a good design because doing
so will make the information stored messy. The application is used to organize personal information conveniently. It is
a major drawback if the data are not stored (and thus presented to users) in a well-organized way.

Learning from many modern database implementations, we should think of the data as two tables: one for *contacts* and the
other one for *events*. Each table is composed of many rows and many columns. A single contact/event is one row, while
all their different properties/fields are the columns (as can be seen from Figure 4.3.1.1 and 4.3.1.2).

image::phpmyadminTableView.png[width="700"]
_Figure 4.3.1.1 : Data Table View of phpMyAdmin (a MySQL visualization tool)_

image::phpmyadminAddColumn.png[width="700"]
_Figure 4.3.1.2 : Add New Column in phpMyAdmin_

==== Design Consideration

**Aspect:** Where to store the "_metadata_" of different properties (short name, full name, regular expression, etc.) +
**Alternative 1 (current choice):** Create a new class `PropertyManager` in Figure 4.3.2.1 +
**Pros:** Efficient (there is only one copy) and easy for future development since it is centralized. +
**Cons:** Requires major change to `Model` component and `Storage` component. +
**Alternative 2:** Store these data along with each specific property class, like `Name`, `Email` +
**Pros:** Able to adapt the current implementation of `Model` component. +
**Cons:** Hard to implement `AddPropertyCommand`, and difficult to manage as the project grows larger.

image::PropertyManagerClassDiagram.png[width="200"]
_Figure 4.3.2.1 : Class Diagram for_ `PropertyManager`

==== Implementation Outline

. Create a more general class to capture the common patterns among all columns (all different fields/properties): according to
the basic OOP concept, a more generic class should become the superclass `Property`; then, other more specific classes
(like `Name`, `Email`, `Phone`, etc.) can inherit from it. This design reduces a lot of code duplicates.

. Find a way to store the metadata of all columns (fields/properties): in popular SQL database implementation, they
usually have a separate database reserved for the database server system itself. We must store similar information somewhere
as well. Thus, we create a `PropertyManager` to store these "metadata", including short names, full names, constraint
messages and regular expressions used for input validation. They are all `static` variables because there should only be
one copy of these "metadata". It will waste a lot of resources if we store these "metadata" with each instance of the
`Property` class.

. _Pre-loaded properties_: Things like `Name`, `Email` and `Phone` are widely used. They should ship with the application
and users do not need any additional setup steps to use them.

. Add new customize properties: advanced users should be provided with a command (`config --add-property`) to add their
own customize fields (as shown in Figure 4.3.3.1). They should have the freedom to arbitrarily choose things like short
name, full name, etc. They can easily add/edit these properties of each contact stored in the application, just like the
_pre-loaded_ ones.

image::PropertyManagerSequenceDiagram.png[width="800"]
_Figure 4.3.3.1 : Sequence Diagram for Adding a Customize Property_

=== Enhancement Added: Import NUSMods Timetable

==== External behavior

---

_(Exclusive feature for NUS students)_

The **BoNUS** team understands that https://nusmods.com/[NUSMods] has become an indispensable school timetable builder
for almost all students at NUS. Thus, you are definitely allowed to import your timetable from NUSMods to the *BoNUS*
application. +
Format: `(i)import --nusmods YOUR_NUSMODS_URL`

****
* The URL provided must be complete and should begin with `http(s)://nusmods.com/timetable/`.
* Directly copy from the address bar of your browser. Do *NOT* use the short URL generated by the _Sharing Timetable_ feature
provided by NUSMods.
* Final examinations for all modules in your NUSMods timetable will be automatically added as events to the application.
****

Example:

* `import --nusmods +++https://nusmods.com/timetable/2017-2018/sem1?CS2103T[TUT]=C01+++`

[NOTE]
====
* Make sure you have stable Internet connection when using this command.
* You may need to wait for a while as the application is retrieving information from NUSMods.
====

==== Justification

---

Most of the NUS students are currently using NUSMods as their school timetable builder. Also, the lessons and exams
reflected on their NUSMods timetable account for a large part of their schedule. Thus, users definitely want to add all
these activities into *BoNUS*. It would be much more convenient if they could import their school timetable to *BoNUS*
directly rather than manually add upcoming events.

==== Implementation

---

=== Import timetable from NUSMods

We implement an  `ImportNusmodsCommand` to help users directly import their NUSMods timetable to *BoNUS* by simply copy-paste
the URL.

==== Inspiration

As stated in <<UserGuide#, User Guide>>, *BoNUS* helps you _better(B) organize(o) your NUS life_. Thus, we want to make
the application an integrated personal manager for NUS students. The main activities for most students are study-related and
most NUS students are currently using https://nusmods.com/[NUSMods] to build their school timetable (as shown in Figure 4.7.1.1).

image::NusmodsWebsite.png[width="750"]
_Figure 4.7.1.1 : NUSMods Website Interface_

Let's imagine some of our users want to use the event feature in *BoNUS*. They want to input final examinations for all
the modules they are taking as upcoming events. It would be very inconvenient and tedious if they have to do this manually.
Even worse, it is very likely they are already using NUSMods and thus are not willing to add these events again. They may
end up not using the event feature at all.

However, users may find it very useful if they can import their NUSMods timetable using a simple command. Eventually, they
would choose *BoNUS* because they can manage both contacts and events in one application conveniently and the migration
from NUSMods to *BoNUS* is not troublesome.

==== Design Considerations

**Aspect:** Relationship between `ImportXmlCommand` and `ImportNusmodsCommand` +
**Alternative 1 (current choice):** Add a new abstract `ImportCommand` class and let both of them become its sub-commands
(inherit from it). +
**Pros:** This is inspired by many popular command-line tools (like Git). `import` is called the actual command, while
`--xml` and `--script` is called the options. Most Unix/Linux users would be used to this approach. This is important for
us because we assume our users are typists and they are very likely to frequently use these command-line tools. +
**Cons:** Need to write extra codes and parsing also becomes more complicated. +
**Alternative 2:** Implement these two commands separately. +
**Pros:** Easy to implement and similar to other commands. +
**Cons:** Our users may not be used to it. The command word will become longer. It is not a good OOP practice as well
because common details are not abstracted into a parent class and this produces duplicate codes.

_(Similar strategy has been adopted in `ConfigCommand`)_

---

**Aspect:** How to obtain user's NUSMods timetable +
**Alternative 1 (current choice):** Let users copy-paste the URL as a parameter of `ImportNusmodsCommand`. +
**Pros:** Simple to use and easy to implement as well +
**Cons:** Need to check whether the URL is valid and from NUSMods (currently using regular expression). +
**Alternative 2:** Implement a built-in browser and render the NUSMods page +
**Pros:** Users are more used to this interface. +
**Cons:** Need much extra work to implement the built-in browser. The page may not be rendered well since the built-in
browser is typically smaller than OS browser and NUSMods does not fully adopt link:#mainstream-os[responsive UI framework]
and may not work well on a small browser window.

==== Implementation Outline

===== `ImportCommand` abstract class

Create an `ImportCommand` abstract class and let `ImportXmlCommand` and `ImportNusmodsCommand` inherit from it (as in
Figure 4.7.3.1). It is also a good practice to use an enumeration `ImportType` because the possible types of the import
are within a fixed set of values. This leads to better modularity in `ImportCommandParser` as well.

image::ImportNusmodsClassDiagram.png[width="600"]
_Figure 4.7.3.1 : Class Diagram for Related Import Commands_ +

===== Parsing of NUSMods Timetable URL

Implement utility method to validate a given URL and parse the `GET` parameters. Although it is possible to utilize
external library like https://hc.apache.org/[Apache HttpComponents], we decide to implement on our own because it is relative
simple to do so and using external library comes with extra expenses (such as licence, etc).

[source,java]
----
public static Map<String, String> fetchUrlParameters(URL url) throws UnsupportedEncodingException {
    String query = urlDecode(url.getQuery());

    if (Strings.isNullOrEmpty(query)) {
        return Collections.emptyMap();
    }

    Map<String, String> pairs = new HashMap<>();
    for (String pair: query.split("&")) {
        int index = pair.indexOf("=");
        pairs.put(pair.substring(0, index), pair.substring(index + 1));
    }

    return pairs;
}
----

===== Fetch information from NUSMods API

The URL parsed just now only contains the module codes and grouping for each module. In order to add upcoming events, we
need more information such as module names, examination dates, etc. We decide to use API provided by NUSMods to fetch the
information we need. NUSMods API is in JSON format, which would be very simple for us as we already use
https://github.com/FasterXML/jackson[Jackson] library in our project.

[source,java]
----
/**
 * Read JSON data from a given URL and convert the data to an instance of the given class.
 * @param url is the URL to the remote JSON data.
 */
public static <T> T fromJsonUrl(URL url, Class<T> instanceClass) throws IOException {
    return objectMapper.readValue(url, instanceClass);
}
----

===== Add upcoming events

After obtaining all the information we need, we can simply use the `addEvent` method in `ModelManager` class to add the
final examinations as upcoming events into *BoNUS*. This should be a similar process as `AddEventCommand`.

=== Enhancement Proposed: Import From BoNUS-specified Script file

==== External behavior

---

==== From `.bo` format

_(Coming in v2.0)_

Imports the data in an external BoNUS script file (which ends with `.bo`), including data from all three components:
*Contacts*, *Events* and *Calendar*, into the application. +
Format: `(i)import --script FILEPATH`

****
* You must explicitly provide the `--script` parameter.
* `FILEPATH` must end with an extension of `.bo`.
* The file name in `FILEPATH` should not be empty, nor should it contain any prohibited characters `?!%*+:|"<>`.
* If a relative path is provided, the data will be imported from a location relative to the *BoNUS* installation directory.
* The provided script file should include one or multiple lines of valid *BoNUS* command(s). Each line can only have **at
most one** command.
* The *command* here refers to any command mentioned in this guide.
****

Examples:

* For `Windows` users: +
`import C:\Users\John Doe\Documents\bonus.bo`

* For `macOS` and `Linux` users: +
`import /Users/John Doe/Documents/bonus.bo`

[NOTE]
====
For `Windows` users, use `\` as the name-separator in your `FILEPATH`. +
For `macOS` and `Linux` users, use `/` instead.
====

==== Justification

---

This feature is meant for advanced users. To build an **epic** application, we need to essentially build an _ecosystem_ for
this software. According to the _Unix_ philosophy, providing a shell scripting and command language is the minimum requirement
for a complete system.

With the support for scripting file, advance users (or system administers if **BoNUS** is used as an enterprise application)
can generate a scripting file and import it into **BoNUS**. Data management and frequent operations can be done easily in
one step. Otherwise, they have to type one command each time in the GUI interface, which becomes a very tedious work.

=== Enhancement Proposed: Export Data to Microsoft Excel^TM^ Worksheet

==== External behavior

---

==== To Microsoft Excel^TM^ Worksheet

_(Coming in v2.0)_

Exports the current data in the application to an external file of Microsoft Excel^TM^ format. +
Format: `(p)export --excel FILEPATH`

****
* The file name should follow similar rules to the section above.
* However, it must end with an extension of `.xls` (`.xlsx` is currently not supported).
****

Examples:

* For `Windows` users: +
`export --excel C:\Users\John Doe\Documents\bonus.xls`

* For `macOS` and `Linux` users: +
`export --excel /Users/John Doe/Documents/bonus.xls`

[NOTE]
====
For `Windows` users, use `\` as the name-separator in your `FILEPATH`. +
For `macOS` and `Linux` users, use `/` instead.
====

==== Justification

---

We already support `ExportCommand` so that users can save data to a separate location as a backup. However, `.xml` files
are not considered to be user-friendly (except for programmers and geeks).

Thus, it becomes essential for us to natively support exporting data to a format with better visuals. As stated before,
data stored in **BoNUS** can be considered as _tables_. Naturally, it comes to my mind that Microsoft Excel^TM^ would
be a perfect format to present data to users.

=== Other contributions

* Repository setup, CI setup and Slack automatic notification using WebHook (Pull requests https://github.com/CS2103AUG2017-T09-B3/main/pull/1[#1],
https://github.com/CS2103AUG2017-T09-B3/main/pull/6[#6], https://github.com/CS2103AUG2017-T09-B3/main/pull/7[#7])
* Design and refine multiple parts of UI (Pull requests https://github.com/CS2103AUG2017-T09-B3/main/pull/41[#41],
https://github.com/CS2103AUG2017-T09-B3/main/pull/43[#43], https://github.com/CS2103AUG2017-T09-B3/main/pull/44[#44],
https://github.com/CS2103AUG2017-T09-B3/main/pull/82[#82], https://github.com/CS2103AUG2017-T09-B3/main/pull/106[#106])
* Support setting customize colors for tags (Pull requests https://github.com/CS2103AUG2017-T09-B3/main/pull/83[#83],
https://github.com/CS2103AUG2017-T09-B3/main/pull/101[#101], https://github.com/CS2103AUG2017-T09-B3/main/pull/147[#147])
* Support natural language parsing (Pull request https://github.com/CS2103AUG2017-T09-B3/main/pull/148[#148])
* Support adding avatar to contacts (Pull request https://github.com/CS2103AUG2017-T09-B3/main/pull/162[#162])
* Write unit tests for various classes
* Update various sections in `AboutUs`, `ContactUs`, `UserGuide` and `DeveloperGuide`, etc.

=== Reuse offer

* Generic property: Issue https://github.com/nus-cs2103-AY1718S1/forum/issues/180[#180]
* Set customize color for tags: Issue https://github.com/nus-cs2103-AY1718S1/forum/issues/199[#199]

=== Helping others

* On the forum: Issue https://github.com/nus-cs2103-AY1718S1/forum/issues/195[#195],
https://github.com/nus-cs2103-AY1718S1/forum/issues/197[#197], https://github.com/nus-cs2103-AY1718S1/forum/issues/200[#200]
* Report bug for https://github.com/CS2103AUG2017-T13-B2/main[UniBook]: Issue https://github.com/CS2103AUG2017-T13-B2/main/issues/72[#72]
* Report bug for https://nus-cs2103.github.io/website/[module website]: Issue https://github.com/nus-cs2103/website/issues/18[#18],
https://github.com/nus-cs2103/website/issues/28[#28], https://github.com/nus-cs2103/website/issues/29[#29],
https://github.com/nus-cs2103/website/issues/34[#34], https://github.com/nus-cs2103/website/issues/39[#39],
https://github.com/nus-cs2103/website/issues/41[#41], https://github.com/nus-cs2103/website/issues/43[#43]
